<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Historie sr√°≈æek ‚Äì Zahr√°dka komunita</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; background: #f0fdf4; padding: 1rem; }
    .box { background: #fff; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
  </style>
</head>
<body>
  <h1>üåßÔ∏è Historie sr√°≈æek ‚Äì Zahr√°dka komunita</h1>
  <div class="box">
    <label for="location">Lokalita:</label>
    <select id="location">
      <option value="50.121,14.538">Vino≈ô (Kbely)</option>
      <option value="50.651,13.778">Dub√≠ u Teplic</option>
      <option value="custom">Vlastn√≠ sou≈ôadnice</option>
    </select>
    <input id="custom" placeholder="Nap≈ô. 49.8,14.3" style="display:none;" />
    <button onclick="load()">Naƒç√≠st sr√°≈æky</button>
  </div>

  <div class="box">
    <h2>Sr√°≈æky za posledn√≠ch 7 dn√≠</h2>
    <table id="rain">
      <thead><tr><th>Datum</th><th>Sr√°≈æky (mm)</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script>
function getDate(offset) {
  const d = new Date();
  d.setDate(d.getDate() - offset);
  return d.toISOString().split("T")[0];
}

async function load() {
  let coords;
  const loc = document.getElementById("location").value;
  if (loc === "custom") {
    coords = document.getElementById("custom").value.split(",").map(x => parseFloat(x.trim()));
  } else {
    coords = loc.split(",").map(x => parseFloat(x));
  }

  const start = getDate(6);
  const end = getDate(0);
  const url = `https://archive-api.open-meteo.com/v1/archive?latitude=${coords[0]}&longitude=${coords[1]}&start_date=${start}&end_date=${end}&daily=precipitation_sum&timezone=Europe%2FBerlin`;

  try {
    const res = await fetch(url);
    const data = await res.json();
    const tbody = document.querySelector("#rain tbody");
    tbody.innerHTML = "";
    for (let i = 0; i < data.daily.time.length; i++) {
      const row = `<tr><td>${data.daily.time[i]}</td><td>${data.daily.precipitation_sum[i]}</td></tr>`;
      tbody.innerHTML += row;
    }
  } catch {
    alert("Chyba p≈ôi naƒç√≠t√°n√≠ dat.");
  }
}

document.getElementById("location").addEventListener("change", e => {
  document.getElementById("custom").style.display = e.target.value === "custom" ? "inline-block" : "none";
});

window.onload = load;
</script>
</body>
</html>
